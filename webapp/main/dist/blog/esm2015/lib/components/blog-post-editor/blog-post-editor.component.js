import { Component, Inject, Input, ViewChild } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { PostsServiceConfigToken } from '../../config/config';
import { uniqueSlugValidator } from '../../validators/unique-slug-validator.directive';
import * as i0 from "@angular/core";
import * as i1 from "../../services/posts.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/router";
import * as i4 from "utils";
import * as i5 from "ngx-markdown";
import * as i6 from "../topic-selector/topic-selector.component";
import * as i7 from "../topic-editor/topic-editor.component";
import * as i8 from "@angular/forms";
import * as i9 from "auth-oidc";
function slugify(text) {
    const from = "ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;";
    const to = "aaaaaeeeeeiiiiooooouuuunc------";
    const newText = text.split('').map((letter, i) => letter.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i)));
    return newText
        .toString() // Cast to string
        .toLowerCase() // Convert the string to lowercase letters
        .trim() // Remove whitespace from both sides of a string
        .replace(/\s+/g, '-') // Replace spaces with -
        .replace(/&/g, '-y-') // Replace & with 'and'
        .replace(/[^\w\-]+/g, '') // Remove all non-word chars
        .replace(/\-\-+/g, '-'); // Replace multiple - with single -
}
export class BlogPostEditorComponent {
    constructor(config, postService, location, activatedRoute) {
        this.config = config;
        this.postService = postService;
        this.location = location;
        this.activatedRoute = activatedRoute;
        this.updateMode = true;
        this.post = null;
        this.successDesc = "";
        this.errorDesc = "";
        this.loading = false;
        this.fetchResponseHandler = {
            next: (result) => {
                this.blogPost = result;
                this.updateForm();
                this.loading = false;
            },
            error: (err) => {
                this.errorDesc = err.message;
                this.loading = false;
                return false;
            }
        };
        this.updateResponseHandler = {
            next: (result) => {
                this.blogPost = result;
                this.assignTopics();
            },
            error: (err) => {
                this.errorDesc = err.message;
                this.loading = false;
                return false;
            }
        };
    }
    ngOnInit() {
        var _a;
        this.form = new FormGroup({
            "title": new FormControl("", [
                Validators.required,
                Validators.maxLength(this.config.maxTitleLength),
            ]),
            "slug": new FormControl("", [
                Validators.required,
                Validators.maxLength(this.config.maxTitleLength),
                Validators.pattern(/^[A-Za-z0-9]+(?:-[A-Za-z0-9]+)*$/)
            ], uniqueSlugValidator(this.postService)),
            "text": new FormControl("", [
                Validators.required,
                Validators.maxLength(this.config.maxContentLength)
            ]),
        });
        (_a = this.title) === null || _a === void 0 ? void 0 : _a.valueChanges.subscribe(val => {
            var _a, _b;
            if (!((_a = this.slug) === null || _a === void 0 ? void 0 : _a.touched) || !((_b = this.slug) === null || _b === void 0 ? void 0 : _b.value)) {
                this.generateSlug();
            }
        });
        this.activatedRoute.params.subscribe(params => {
            var _a;
            this.postId = (_a = params.postId) !== null && _a !== void 0 ? _a : this.paramPostId;
            if (this.isUpdateMode)
                this.fetchPost(this.postId);
        });
    }
    get isUpdateMode() {
        return this.updateMode && this.postId !== undefined;
    }
    get title() { return this.form.get('title'); }
    get slug() { return this.form.get('slug'); }
    get text() { return this.form.get('text'); }
    get selectedTopics() {
        var _a;
        return ((_a = this.post) === null || _a === void 0 ? void 0 : _a.topics) || [];
    }
    set blogPost(item) {
        var _a;
        this.post = this.updateMode ? item : null;
        this.postId = this.updateMode ? (_a = this.post) === null || _a === void 0 ? void 0 : _a.id : undefined;
        console.info("Got post id: " + this.postId);
    }
    generateSlug() {
        var _a, _b;
        (_a = this.slug) === null || _a === void 0 ? void 0 : _a.setValue(slugify((_b = this.title) === null || _b === void 0 ? void 0 : _b.value));
    }
    updateForm() {
        var _a, _b, _c;
        this.title.setValue((_a = this.post) === null || _a === void 0 ? void 0 : _a.title);
        this.slug.setValue((_b = this.post) === null || _b === void 0 ? void 0 : _b.slug);
        this.text.setValue((_c = this.post) === null || _c === void 0 ? void 0 : _c.text);
    }
    fetchPost(postId) {
        this.loading = true;
        this.postService
            .one("posts", postId)
            .subscribe(this.fetchResponseHandler);
    }
    createNewPost() {
        var _a, _b, _c;
        this.postService
            .create("posts", (_a = this.slug) === null || _a === void 0 ? void 0 : _a.value, (_b = this.title) === null || _b === void 0 ? void 0 : _b.value, (_c = this.text) === null || _c === void 0 ? void 0 : _c.value)
            .subscribe(this.updateResponseHandler);
    }
    updatePost() {
        var _a, _b, _c;
        this.postService
            .update("posts", this.postId, (_a = this.slug) === null || _a === void 0 ? void 0 : _a.value, (_b = this.title) === null || _b === void 0 ? void 0 : _b.value, (_c = this.text) === null || _c === void 0 ? void 0 : _c.value)
            .subscribe(this.updateResponseHandler);
    }
    assignTopics() {
        const selectedTopics = this.topicSelector.selectedTopics.map(i => i.id);
        console.info(selectedTopics);
        this.postService
            .assignTopics("posts", this.postId, selectedTopics)
            .subscribe({
            next: () => {
                this.updateForm();
                this.successDesc = "Post updated successfully!";
                this.loading = false;
            },
            error: (err) => {
                this.errorDesc = err.message;
                this.loading = false;
                return false;
            }
        });
    }
    cancel() {
        this.location.back();
    }
}
BlogPostEditorComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: BlogPostEditorComponent, deps: [{ token: PostsServiceConfigToken }, { token: i1.PostsService }, { token: i2.Location }, { token: i3.ActivatedRoute }], target: i0.ɵɵFactoryTarget.Component });
BlogPostEditorComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.4", type: BlogPostEditorComponent, selector: "blog-post-editor", inputs: { headerTemplate: "headerTemplate", paramPostId: ["postId", "paramPostId"], updateMode: "updateMode" }, viewQueries: [{ propertyName: "topicSelector", first: true, predicate: ["topicSelector"], descendants: true }], ngImport: i0, template: "<div *ngIf=\"loading; else contents\">\n    <utils-loader></utils-loader>\n</div>\n\n<ng-template #defaultTitleTemplate let-item>\n    <div class=\"d-flex justify-content-between\">\n        <div>\n            <h5>WRITE A POST</h5>\n        </div>\n        <div><a class=\"btn btn-success\" role=\"button\" (click)=\"cancel()\">Cancel</a></div>\n    </div>\n    <hr class=\"my-4\">\n</ng-template>\n\n<ng-template #contents>\n    <ng-container \n        [ngTemplateOutlet]=\"headerTemplate || defaultTitleTemplate\"\n        [ngTemplateOutletContext]=\"{ $implicit: this }\">\n    </ng-container>\n    <utils-alert *ngIf=\"successDesc\" [dismissable]=\"false\" [minimal]=\"false\">\n        <p>{{ successDesc }}</p>\n    </utils-alert>\n    <utils-alert *ngIf=\"errorDesc; else editor\" [dismissable]=\"false\" [minimal]=\"false\">\n        <p>An error occurred accessing the post: {{ errorDesc }}</p>\n    </utils-alert>\n</ng-template>\n\n<ng-template #editor>\n    <form [formGroup]=\"form\" novalidate onSubmit=\"return false;\">\n        <div class=\"row\">\n            <div class=\"mb-3 col-sm-12\">\n                <label for=\"title\" class=\"form-label\">Title</label>\n                <input type=\"text\" class=\"form-control\" id=\"title\" \n                    placeholder=\"Title of your post ... \"\n                    formControlName=\"title\" required>\n\n                <div *ngIf=\"title?.invalid && (title?.dirty || title?.touched)\">\n                    <utils-alert *ngIf=\"title?.errors?.required\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Title is required.\n                    </utils-alert>\n                    <utils-alert *ngIf=\"title?.errors?.maxLength\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Title length exceeds limit.\n                    </utils-alert>\n                </div>\n\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"mb-3 col-sm-12\">\n                <label for=\"slug\" class=\"form-label\">Slug</label>\n                <div class=\"d-flex justify-content-between\">\n                    <input type=\"text\" class=\"form-control\" id=\"slug\" \n                        placeholder=\"Slug goes here ... e.g. this-is-a-valid-slug\"\n                        formControlName=\"slug\" required>\n                    <input class=\"btn btn-primary ml-1\" type=\"button\" [disabled]=\"loading\" value=\"Auto Generate\" (click)=\"generateSlug()\">\n                </div>\n                <div *ngIf=\"slug?.invalid && (slug?.dirty || slug?.touched)\">\n                    <utils-alert *ngIf=\"slug?.errors?.required\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Slug is required.\n                    </utils-alert>\n                    <utils-alert *ngIf=\"slug?.errors?.maxLength\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Slug length exceeds limit.\n                    </utils-alert>\n                    <utils-alert *ngIf=\"slug?.errors?.pattern\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Only clean url like expressions are allowed in slugs e.g. this-is-a-valid-slug\n                    </utils-alert>\n                    <utils-alert *ngIf=\"slug?.errors?.slugExists\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Slug is already taken!\n                    </utils-alert>\n                </div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"mb-3 col-sm-6\">\n                <label for=\"text\" class=\"form-label\">Write your story here:</label>\n                <textarea class=\"form-control\" id=\"postText\" rows=\"3\" formControlName=\"text\" required></textarea>\n\n                <div *ngIf=\"text?.invalid && (text?.dirty || text?.touched)\">\n                    <utils-alert *ngIf=\"text?.errors?.pattern\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Sorry, cannot leave this empty!\n                    </utils-alert>\n                    <utils-alert *ngIf=\"text?.errors?.maxLength\" [dismissable]=\"false\" [minimal]=\"true\">\n                        Conent length exceeds limit.\n                    </utils-alert>\n                </div>\n\n            </div>\n            <div class=\"mb-3 col-sm-6\">\n                <label class=\"form-label\">Preview</label>\n                <markdown class=\"variable-binding\" [data]=\"text?.value\"></markdown>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"mb-3 col-sm-12\">\n                <topic-selector #topicSelector \n                    [initialTopics]=\"selectedTopics\"\n                    [noContentsTemplate]=\"topicsNotFoundTemplate\">\n                </topic-selector>\n            </div>\n        </div>\n        <div class=\"mb-3\" *ngIf=\"!isUpdateMode\">\n            <input class=\"btn btn-primary\" type=\"button\" [disabled]=\"loading || !form.valid\" value=\"Post\" (click)=\"createNewPost()\">\n        </div>\n        <div class=\"mb-3\" *ngIf=\"isUpdateMode\">\n            <input class=\"btn btn-primary\" type=\"button\" [disabled]=\"loading || !form.valid\" value=\"Update\" (click)=\"updatePost()\">\n        </div>\n    </form>\n</ng-template>\n\n<ng-template #topicsNotFoundTemplate let-item>\n    No topic found!\n    <topic-editor *authRequireRole=\"'admin'\"></topic-editor>\n</ng-template>\n", styles: [""], components: [{ type: i4.LoaderComponent, selector: "utils-loader", inputs: ["controlTemplate"] }, { type: i4.AlertComponent, selector: "utils-alert", inputs: ["minimal", "dismissable", "title", "kind", "controlTemplate"], outputs: ["onClosed"] }, { type: i5.MarkdownComponent, selector: "markdown, [markdown]", inputs: ["data", "src", "emoji", "katex", "katexOptions", "lineHighlight", "line", "lineOffset", "lineNumbers", "start"], outputs: ["error", "load", "ready"] }, { type: i6.TopicSelectorComponent, selector: "topic-selector", inputs: ["maxTopics", "initialTopics", "itemTemplate", "noContentsTemplate"] }, { type: i7.TopicEditorComponent, selector: "topic-editor", inputs: ["headerTemplate", "topicId", "updateMode"] }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i8.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i8.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i8.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i8.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i8.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i8.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i8.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i9.RequireRoleDirective, selector: "[authRequireRole]", inputs: ["authRequireRole", "authRequireRoleElse", "authRequireRoleThen"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: BlogPostEditorComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'blog-post-editor',
                    templateUrl: './blog-post-editor.component.html',
                    styleUrls: ['./blog-post-editor.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [PostsServiceConfigToken]
                }] }, { type: i1.PostsService }, { type: i2.Location }, { type: i3.ActivatedRoute }]; }, propDecorators: { headerTemplate: [{
                type: Input
            }], paramPostId: [{
                type: Input,
                args: ["postId"]
            }], updateMode: [{
                type: Input
            }], topicSelector: [{
                type: ViewChild,
                args: ['topicSelector']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvZy1wb3N0LWVkaXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ibG9nL3NyYy9saWIvY29tcG9uZW50cy9ibG9nLXBvc3QtZWRpdG9yL2Jsb2ctcG9zdC1lZGl0b3IuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYmxvZy9zcmMvbGliL2NvbXBvbmVudHMvYmxvZy1wb3N0LWVkaXRvci9ibG9nLXBvc3QtZWRpdG9yLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBdUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pGLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBFLE9BQU8sRUFBc0IsdUJBQXVCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUtsRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxrREFBa0QsQ0FBQzs7Ozs7Ozs7Ozs7QUFHdkYsU0FBUyxPQUFPLENBQUMsSUFBWTtJQUMzQixNQUFNLElBQUksR0FBRyxpQ0FBaUMsQ0FBQTtJQUM5QyxNQUFNLEVBQUUsR0FBRyxpQ0FBaUMsQ0FBQTtJQUU1QyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FDaEMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFL0UsT0FBTyxPQUFPO1NBQ1gsUUFBUSxFQUFFLENBQXFC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QUNGLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN2QixDQUFDOztvSEF0SlUsdUJBQXVCLGtCQW1CeEIsdUJBQXVCO3dHQW5CdEIsdUJBQXVCLHdSQ2xDcEMsazJLQWlIQTsyRkQvRWEsdUJBQXVCO2tCQUxuQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLFdBQVcsRUFBRSxtQ0FBbUM7b0JBQ2hELFNBQVMsRUFBRSxDQUFDLG1DQUFtQyxDQUFDO2lCQUNqRDs7MEJBb0JJLE1BQU07MkJBQUMsdUJBQXVCOzJIQWpCeEIsY0FBYztzQkFBdEIsS0FBSztnQkFDVyxXQUFXO3NCQUEzQixLQUFLO3VCQUFDLFFBQVE7Z0JBQ04sVUFBVTtzQkFBbEIsS0FBSztnQkFZTixhQUFhO3NCQURaLFNBQVM7dUJBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2F0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5qZWN0LCBJbnB1dCwgT25Jbml0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBQb3N0c1NlcnZpY2VDb25maWcsIFBvc3RzU2VydmljZUNvbmZpZ1Rva2VuIH0gZnJvbSAnLi4vLi4vY29uZmlnL2NvbmZpZyc7XG5pbXBvcnQgeyBCbG9nUG9zdE1vZGVsLCBCbG9nUG9zdFJlc3BvbnNlTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvYmxvZy1wb3N0JztcbmltcG9ydCB7IFRvcGljTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvdG9waWMnO1xuaW1wb3J0IHsgUG9zdHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG9zdHMuc2VydmljZSc7XG5pbXBvcnQgeyBUb3BpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdG9waWNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgdW5pcXVlU2x1Z1ZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3ZhbGlkYXRvcnMvdW5pcXVlLXNsdWctdmFsaWRhdG9yLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBUb3BpY1NlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vdG9waWMtc2VsZWN0b3IvdG9waWMtc2VsZWN0b3IuY29tcG9uZW50JztcblxuZnVuY3Rpb24gc2x1Z2lmeSh0ZXh0OiBzdHJpbmcpIHtcbiAgY29uc3QgZnJvbSA9IFwiw6PDoMOhw6TDouG6vcOow6nDq8Oqw6zDrcOvw67DtcOyw7PDtsO0w7nDusO8w7vDscOnwrcvXyw6O1wiXG4gIGNvbnN0IHRvID0gXCJhYWFhYWVlZWVlaWlpaW9vb29vdXV1dW5jLS0tLS0tXCJcblxuICBjb25zdCBuZXdUZXh0ID0gdGV4dC5zcGxpdCgnJykubWFwKFxuICAgIChsZXR0ZXIsIGkpID0+IGxldHRlci5yZXBsYWNlKG5ldyBSZWdFeHAoZnJvbS5jaGFyQXQoaSksICdnJyksIHRvLmNoYXJBdChpKSkpXG5cbiAgcmV0dXJuIG5ld1RleHRcbiAgICAudG9TdHJpbmcoKSAgICAgICAgICAgICAgICAgICAgIC8vIENhc3QgdG8gc3RyaW5nXG4gICAgLnRvTG93ZXJDYXNlKCkgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBzdHJpbmcgdG8gbG93ZXJjYXNlIGxldHRlcnNcbiAgICAudHJpbSgpICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB3aGl0ZXNwYWNlIGZyb20gYm90aCBzaWRlcyBvZiBhIHN0cmluZ1xuICAgIC5yZXBsYWNlKC9cXHMrL2csICctJykgICAgICAgICAgIC8vIFJlcGxhY2Ugc3BhY2VzIHdpdGggLVxuICAgIC5yZXBsYWNlKC8mL2csICcteS0nKSAgICAgICAgICAgLy8gUmVwbGFjZSAmIHdpdGggJ2FuZCdcbiAgICAucmVwbGFjZSgvW15cXHdcXC1dKy9nLCAnJykgICAgICAgLy8gUmVtb3ZlIGFsbCBub24td29yZCBjaGFyc1xuICAgIC5yZXBsYWNlKC9cXC1cXC0rL2csICctJyk7ICAgICAgICAvLyBSZXBsYWNlIG11bHRpcGxlIC0gd2l0aCBzaW5nbGUgLVxufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdibG9nLXBvc3QtZWRpdG9yJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Jsb2ctcG9zdC1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9ibG9nLXBvc3QtZWRpdG9yLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQmxvZ1Bvc3RFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIGhlYWRlclRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgdW5kZWZpbmVkO1xuICBASW5wdXQoXCJwb3N0SWRcIikgcGFyYW1Qb3N0SWQ/OiBudW1iZXI7XG4gIEBJbnB1dCgpIHVwZGF0ZU1vZGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIHBvc3RJZD86IG51bWJlcjtcbiAgcG9zdCA6IEJsb2dQb3N0TW9kZWx8bnVsbCA9IG51bGw7XG5cbiAgc3VjY2Vzc0Rlc2M6IGFueSA9IFwiXCI7XG4gIGVycm9yRGVzYzogYW55ID0gXCJcIjtcbiAgbG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIGZvcm0hOiBGb3JtR3JvdXA7XG5cbiAgQFZpZXdDaGlsZCgndG9waWNTZWxlY3RvcicpXG4gIHRvcGljU2VsZWN0b3IhOiBUb3BpY1NlbGVjdG9yQ29tcG9uZW50O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoUG9zdHNTZXJ2aWNlQ29uZmlnVG9rZW4pIHByaXZhdGUgY29uZmlnOiBQb3N0c1NlcnZpY2VDb25maWcsXG4gICAgcHJpdmF0ZSBwb3N0U2VydmljZTogUG9zdHNTZXJ2aWNlLCBcbiAgICBwcml2YXRlIGxvY2F0aW9uOiBMb2NhdGlvbixcbiAgICBwcml2YXRlIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcblxuICAgIHRoaXMuZm9ybSA9IG5ldyBGb3JtR3JvdXAoXG4gICAge1xuICAgICAgXCJ0aXRsZVwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgW1xuICAgICAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsXG4gICAgICAgICAgVmFsaWRhdG9ycy5tYXhMZW5ndGgodGhpcy5jb25maWcubWF4VGl0bGVMZW5ndGgpLFxuICAgICAgICBdKSxcbiAgICAgIFwic2x1Z1wiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgW1xuICAgICAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsXG4gICAgICAgICAgVmFsaWRhdG9ycy5tYXhMZW5ndGgodGhpcy5jb25maWcubWF4VGl0bGVMZW5ndGgpLFxuICAgICAgICAgIFZhbGlkYXRvcnMucGF0dGVybigvXltBLVphLXowLTldKyg/Oi1bQS1aYS16MC05XSspKiQvKVxuICAgICAgICBdLCBcbiAgICAgICAgdW5pcXVlU2x1Z1ZhbGlkYXRvcih0aGlzLnBvc3RTZXJ2aWNlKVxuICAgICAgKSxcbiAgICAgIFwidGV4dFwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgW1xuICAgICAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsIFxuICAgICAgICAgIFZhbGlkYXRvcnMubWF4TGVuZ3RoKHRoaXMuY29uZmlnLm1heENvbnRlbnRMZW5ndGgpXG4gICAgICAgIF0pLFxuICAgIH0pO1xuXG4gICAgdGhpcy50aXRsZT8udmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWwgPT4ge1xuICAgICAgaWYoIXRoaXMuc2x1Zz8udG91Y2hlZCB8fCAhdGhpcy5zbHVnPy52YWx1ZSkge1xuICAgICAgICB0aGlzLmdlbmVyYXRlU2x1ZygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5wYXJhbXMuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XG4gICAgICB0aGlzLnBvc3RJZCA9IHBhcmFtcy5wb3N0SWQgPz8gdGhpcy5wYXJhbVBvc3RJZDtcbiAgICAgIGlmKHRoaXMuaXNVcGRhdGVNb2RlKVxuICAgICAgICB0aGlzLmZldGNoUG9zdCh0aGlzLnBvc3RJZCEpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0IGlzVXBkYXRlTW9kZSgpOiBib29sZWFuIHsgXG4gICAgcmV0dXJuIHRoaXMudXBkYXRlTW9kZSAmJiB0aGlzLnBvc3RJZCAhPT0gdW5kZWZpbmVkOyBcbiAgfVxuICBnZXQgdGl0bGUoKSB7IHJldHVybiB0aGlzLmZvcm0uZ2V0KCd0aXRsZScpOyB9XG4gIGdldCBzbHVnKCkgeyByZXR1cm4gdGhpcy5mb3JtLmdldCgnc2x1ZycpOyB9XG4gIGdldCB0ZXh0KCkgeyByZXR1cm4gdGhpcy5mb3JtLmdldCgndGV4dCcpOyB9XG5cbiAgZ2V0IHNlbGVjdGVkVG9waWNzKCk6IFRvcGljTW9kZWxbXSB7XG4gICAgcmV0dXJuIHRoaXMucG9zdD8udG9waWNzIHx8IFtdO1xuICB9XG5cbiAgc2V0IGJsb2dQb3N0KGl0ZW06IEJsb2dQb3N0TW9kZWwpIHtcbiAgICB0aGlzLnBvc3QgPSB0aGlzLnVwZGF0ZU1vZGUgPyBpdGVtIDogbnVsbDtcbiAgICB0aGlzLnBvc3RJZCA9IHRoaXMudXBkYXRlTW9kZSA/IHRoaXMucG9zdD8uaWQgOiB1bmRlZmluZWQ7XG4gICAgY29uc29sZS5pbmZvKFwiR290IHBvc3QgaWQ6IFwiICsgdGhpcy5wb3N0SWQhKTtcbiAgfVxuXG4gIGdlbmVyYXRlU2x1ZygpOiB2b2lkIHtcbiAgICB0aGlzLnNsdWc/LnNldFZhbHVlKHNsdWdpZnkodGhpcy50aXRsZT8udmFsdWUpKTtcbiAgfVxuXG4gIHVwZGF0ZUZvcm0oKTogdm9pZCB7XG4gICAgdGhpcy50aXRsZSEuc2V0VmFsdWUgKHRoaXMucG9zdD8udGl0bGUpO1xuICAgIHRoaXMuc2x1ZyEuc2V0VmFsdWUgKHRoaXMucG9zdD8uc2x1Zyk7XG4gICAgdGhpcy50ZXh0IS5zZXRWYWx1ZSAodGhpcy5wb3N0Py50ZXh0KTtcbiAgfVxuXG4gIGZldGNoUmVzcG9uc2VIYW5kbGVyID0ge1xuICAgIG5leHQ6IChyZXN1bHQ6IEJsb2dQb3N0UmVzcG9uc2VNb2RlbCkgPT4ge1xuICAgICAgdGhpcy5ibG9nUG9zdCA9IHJlc3VsdDtcbiAgICAgIHRoaXMudXBkYXRlRm9ybSgpO1xuICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgfSxcbiAgICBlcnJvcjogKGVycjogYW55KSA9PiB7XG4gICAgICB0aGlzLmVycm9yRGVzYyA9IGVyci5tZXNzYWdlO1xuICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIGZldGNoUG9zdChwb3N0SWQ6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5wb3N0U2VydmljZVxuICAgICAgLm9uZShcInBvc3RzXCIsIHBvc3RJZClcbiAgICAgIC5zdWJzY3JpYmUodGhpcy5mZXRjaFJlc3BvbnNlSGFuZGxlcik7XG4gIH0gICAgICBcblxuICB1cGRhdGVSZXNwb25zZUhhbmRsZXIgPSB7XG4gICAgbmV4dDogKHJlc3VsdDogQmxvZ1Bvc3RSZXNwb25zZU1vZGVsKSA9PiB7XG4gICAgICB0aGlzLmJsb2dQb3N0ID0gcmVzdWx0O1xuICAgICAgdGhpcy5hc3NpZ25Ub3BpY3MoKTtcbiAgICB9LFxuICAgIGVycm9yOiAoZXJyOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuZXJyb3JEZXNjID0gZXJyLm1lc3NhZ2U7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgY3JlYXRlTmV3UG9zdCgpOiB2b2lkIHtcbiAgICB0aGlzLnBvc3RTZXJ2aWNlXG4gICAgICAuY3JlYXRlKFwicG9zdHNcIiwgdGhpcy5zbHVnPy52YWx1ZSwgdGhpcy50aXRsZT8udmFsdWUsIHRoaXMudGV4dD8udmFsdWUpXG4gICAgICAuc3Vic2NyaWJlKHRoaXMudXBkYXRlUmVzcG9uc2VIYW5kbGVyKTtcbiAgfVxuXG4gIHVwZGF0ZVBvc3QoKTogdm9pZCB7XG4gICAgdGhpcy5wb3N0U2VydmljZVxuICAgICAgLnVwZGF0ZShcInBvc3RzXCIsIHRoaXMucG9zdElkISwgdGhpcy5zbHVnPy52YWx1ZSwgdGhpcy50aXRsZT8udmFsdWUsIHRoaXMudGV4dD8udmFsdWUpXG4gICAgICAuc3Vic2NyaWJlKHRoaXMudXBkYXRlUmVzcG9uc2VIYW5kbGVyKTtcbiAgfVxuXG4gIGFzc2lnblRvcGljcygpOiB2b2lkIHtcbiAgICBjb25zdCBzZWxlY3RlZFRvcGljcyA9IHRoaXMudG9waWNTZWxlY3Rvci5zZWxlY3RlZFRvcGljcy5tYXAoaSA9PiBpLmlkKTtcbiAgICBjb25zb2xlLmluZm8oc2VsZWN0ZWRUb3BpY3MpO1xuICAgIHRoaXMucG9zdFNlcnZpY2VcbiAgICAgIC5hc3NpZ25Ub3BpY3MoXCJwb3N0c1wiLCB0aGlzLnBvc3RJZCEsIHNlbGVjdGVkVG9waWNzKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUZvcm0oKTtcbiAgICAgICAgICB0aGlzLnN1Y2Nlc3NEZXNjID0gXCJQb3N0IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IVwiO1xuICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5lcnJvckRlc2MgPSBlcnIubWVzc2FnZTtcbiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgY2FuY2VsKCk6IHZvaWQge1xuICAgIHRoaXMubG9jYXRpb24uYmFjaygpO1xuICB9XG59XG4iLCI8ZGl2ICpuZ0lmPVwibG9hZGluZzsgZWxzZSBjb250ZW50c1wiPlxuICAgIDx1dGlscy1sb2FkZXI+PC91dGlscy1sb2FkZXI+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNkZWZhdWx0VGl0bGVUZW1wbGF0ZSBsZXQtaXRlbT5cbiAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8aDU+V1JJVEUgQSBQT1NUPC9oNT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXY+PGEgY2xhc3M9XCJidG4gYnRuLXN1Y2Nlc3NcIiByb2xlPVwiYnV0dG9uXCIgKGNsaWNrKT1cImNhbmNlbCgpXCI+Q2FuY2VsPC9hPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxociBjbGFzcz1cIm15LTRcIj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjY29udGVudHM+XG4gICAgPG5nLWNvbnRhaW5lciBcbiAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiaGVhZGVyVGVtcGxhdGUgfHwgZGVmYXVsdFRpdGxlVGVtcGxhdGVcIlxuICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IHRoaXMgfVwiPlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDx1dGlscy1hbGVydCAqbmdJZj1cInN1Y2Nlc3NEZXNjXCIgW2Rpc21pc3NhYmxlXT1cImZhbHNlXCIgW21pbmltYWxdPVwiZmFsc2VcIj5cbiAgICAgICAgPHA+e3sgc3VjY2Vzc0Rlc2MgfX08L3A+XG4gICAgPC91dGlscy1hbGVydD5cbiAgICA8dXRpbHMtYWxlcnQgKm5nSWY9XCJlcnJvckRlc2M7IGVsc2UgZWRpdG9yXCIgW2Rpc21pc3NhYmxlXT1cImZhbHNlXCIgW21pbmltYWxdPVwiZmFsc2VcIj5cbiAgICAgICAgPHA+QW4gZXJyb3Igb2NjdXJyZWQgYWNjZXNzaW5nIHRoZSBwb3N0OiB7eyBlcnJvckRlc2MgfX08L3A+XG4gICAgPC91dGlscy1hbGVydD5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZWRpdG9yPlxuICAgIDxmb3JtIFtmb3JtR3JvdXBdPVwiZm9ybVwiIG5vdmFsaWRhdGUgb25TdWJtaXQ9XCJyZXR1cm4gZmFsc2U7XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zIGNvbC1zbS0xMlwiPlxuICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJ0aXRsZVwiIGNsYXNzPVwiZm9ybS1sYWJlbFwiPlRpdGxlPC9sYWJlbD5cbiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwidGl0bGVcIiBcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJUaXRsZSBvZiB5b3VyIHBvc3QgLi4uIFwiXG4gICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInRpdGxlXCIgcmVxdWlyZWQ+XG5cbiAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwidGl0bGU/LmludmFsaWQgJiYgKHRpdGxlPy5kaXJ0eSB8fCB0aXRsZT8udG91Y2hlZClcIj5cbiAgICAgICAgICAgICAgICAgICAgPHV0aWxzLWFsZXJ0ICpuZ0lmPVwidGl0bGU/LmVycm9ycz8ucmVxdWlyZWRcIiBbZGlzbWlzc2FibGVdPVwiZmFsc2VcIiBbbWluaW1hbF09XCJ0cnVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSBpcyByZXF1aXJlZC5cbiAgICAgICAgICAgICAgICAgICAgPC91dGlscy1hbGVydD5cbiAgICAgICAgICAgICAgICAgICAgPHV0aWxzLWFsZXJ0ICpuZ0lmPVwidGl0bGU/LmVycm9ycz8ubWF4TGVuZ3RoXCIgW2Rpc21pc3NhYmxlXT1cImZhbHNlXCIgW21pbmltYWxdPVwidHJ1ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgVGl0bGUgbGVuZ3RoIGV4Y2VlZHMgbGltaXQuXG4gICAgICAgICAgICAgICAgICAgIDwvdXRpbHMtYWxlcnQ+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTMgY29sLXNtLTEyXCI+XG4gICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cInNsdWdcIiBjbGFzcz1cImZvcm0tbGFiZWxcIj5TbHVnPC9sYWJlbD5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJzbHVnXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNsdWcgZ29lcyBoZXJlIC4uLiBlLmcuIHRoaXMtaXMtYS12YWxpZC1zbHVnXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInNsdWdcIiByZXF1aXJlZD5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5IG1sLTFcIiB0eXBlPVwiYnV0dG9uXCIgW2Rpc2FibGVkXT1cImxvYWRpbmdcIiB2YWx1ZT1cIkF1dG8gR2VuZXJhdGVcIiAoY2xpY2spPVwiZ2VuZXJhdGVTbHVnKClcIj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwic2x1Zz8uaW52YWxpZCAmJiAoc2x1Zz8uZGlydHkgfHwgc2x1Zz8udG91Y2hlZClcIj5cbiAgICAgICAgICAgICAgICAgICAgPHV0aWxzLWFsZXJ0ICpuZ0lmPVwic2x1Zz8uZXJyb3JzPy5yZXF1aXJlZFwiIFtkaXNtaXNzYWJsZV09XCJmYWxzZVwiIFttaW5pbWFsXT1cInRydWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIFNsdWcgaXMgcmVxdWlyZWQuXG4gICAgICAgICAgICAgICAgICAgIDwvdXRpbHMtYWxlcnQ+XG4gICAgICAgICAgICAgICAgICAgIDx1dGlscy1hbGVydCAqbmdJZj1cInNsdWc/LmVycm9ycz8ubWF4TGVuZ3RoXCIgW2Rpc21pc3NhYmxlXT1cImZhbHNlXCIgW21pbmltYWxdPVwidHJ1ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgU2x1ZyBsZW5ndGggZXhjZWVkcyBsaW1pdC5cbiAgICAgICAgICAgICAgICAgICAgPC91dGlscy1hbGVydD5cbiAgICAgICAgICAgICAgICAgICAgPHV0aWxzLWFsZXJ0ICpuZ0lmPVwic2x1Zz8uZXJyb3JzPy5wYXR0ZXJuXCIgW2Rpc21pc3NhYmxlXT1cImZhbHNlXCIgW21pbmltYWxdPVwidHJ1ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgT25seSBjbGVhbiB1cmwgbGlrZSBleHByZXNzaW9ucyBhcmUgYWxsb3dlZCBpbiBzbHVncyBlLmcuIHRoaXMtaXMtYS12YWxpZC1zbHVnXG4gICAgICAgICAgICAgICAgICAgIDwvdXRpbHMtYWxlcnQ+XG4gICAgICAgICAgICAgICAgICAgIDx1dGlscy1hbGVydCAqbmdJZj1cInNsdWc/LmVycm9ycz8uc2x1Z0V4aXN0c1wiIFtkaXNtaXNzYWJsZV09XCJmYWxzZVwiIFttaW5pbWFsXT1cInRydWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIFNsdWcgaXMgYWxyZWFkeSB0YWtlbiFcbiAgICAgICAgICAgICAgICAgICAgPC91dGlscy1hbGVydD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTMgY29sLXNtLTZcIj5cbiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1sYWJlbFwiPldyaXRlIHlvdXIgc3RvcnkgaGVyZTo8L2xhYmVsPlxuICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwicG9zdFRleHRcIiByb3dzPVwiM1wiIGZvcm1Db250cm9sTmFtZT1cInRleHRcIiByZXF1aXJlZD48L3RleHRhcmVhPlxuXG4gICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cInRleHQ/LmludmFsaWQgJiYgKHRleHQ/LmRpcnR5IHx8IHRleHQ/LnRvdWNoZWQpXCI+XG4gICAgICAgICAgICAgICAgICAgIDx1dGlscy1hbGVydCAqbmdJZj1cInRleHQ/LmVycm9ycz8ucGF0dGVyblwiIFtkaXNtaXNzYWJsZV09XCJmYWxzZVwiIFttaW5pbWFsXT1cInRydWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnJ5LCBjYW5ub3QgbGVhdmUgdGhpcyBlbXB0eSFcbiAgICAgICAgICAgICAgICAgICAgPC91dGlscy1hbGVydD5cbiAgICAgICAgICAgICAgICAgICAgPHV0aWxzLWFsZXJ0ICpuZ0lmPVwidGV4dD8uZXJyb3JzPy5tYXhMZW5ndGhcIiBbZGlzbWlzc2FibGVdPVwiZmFsc2VcIiBbbWluaW1hbF09XCJ0cnVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICBDb25lbnQgbGVuZ3RoIGV4Y2VlZHMgbGltaXQuXG4gICAgICAgICAgICAgICAgICAgIDwvdXRpbHMtYWxlcnQ+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTMgY29sLXNtLTZcIj5cbiAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJmb3JtLWxhYmVsXCI+UHJldmlldzwvbGFiZWw+XG4gICAgICAgICAgICAgICAgPG1hcmtkb3duIGNsYXNzPVwidmFyaWFibGUtYmluZGluZ1wiIFtkYXRhXT1cInRleHQ/LnZhbHVlXCI+PC9tYXJrZG93bj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTMgY29sLXNtLTEyXCI+XG4gICAgICAgICAgICAgICAgPHRvcGljLXNlbGVjdG9yICN0b3BpY1NlbGVjdG9yIFxuICAgICAgICAgICAgICAgICAgICBbaW5pdGlhbFRvcGljc109XCJzZWxlY3RlZFRvcGljc1wiXG4gICAgICAgICAgICAgICAgICAgIFtub0NvbnRlbnRzVGVtcGxhdGVdPVwidG9waWNzTm90Rm91bmRUZW1wbGF0ZVwiPlxuICAgICAgICAgICAgICAgIDwvdG9waWMtc2VsZWN0b3I+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCIgKm5nSWY9XCIhaXNVcGRhdGVNb2RlXCI+XG4gICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIiB0eXBlPVwiYnV0dG9uXCIgW2Rpc2FibGVkXT1cImxvYWRpbmcgfHwgIWZvcm0udmFsaWRcIiB2YWx1ZT1cIlBvc3RcIiAoY2xpY2spPVwiY3JlYXRlTmV3UG9zdCgpXCI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiICpuZ0lmPVwiaXNVcGRhdGVNb2RlXCI+XG4gICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIiB0eXBlPVwiYnV0dG9uXCIgW2Rpc2FibGVkXT1cImxvYWRpbmcgfHwgIWZvcm0udmFsaWRcIiB2YWx1ZT1cIlVwZGF0ZVwiIChjbGljayk9XCJ1cGRhdGVQb3N0KClcIj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9mb3JtPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICN0b3BpY3NOb3RGb3VuZFRlbXBsYXRlIGxldC1pdGVtPlxuICAgIE5vIHRvcGljIGZvdW5kIVxuICAgIDx0b3BpYy1lZGl0b3IgKmF1dGhSZXF1aXJlUm9sZT1cIidhZG1pbidcIj48L3RvcGljLWVkaXRvcj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=