import { Inject, Injectable } from '@angular/core';
import { Subject, throwError } from 'rxjs';
import { catchError, map, tap } from "rxjs/operators";
import { PostsServiceConfigToken } from '../config/config';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class PostsService {
    constructor(config, httpClient) {
        this.config = config;
        this.httpClient = httpClient;
        this.onChange = new Subject();
    }
    all(endpoint, pageable) {
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}`, {
            params: {
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "createdOn,desc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    one(endpoint, id) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`)
            .pipe(map(data => {
            return data;
        }));
    }
    findBySlug(endpoint, slug) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const query = {
            "conditions": [
                { "attribute": "slug", "operator": "eq", "value": slug }
            ]
        };
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/search`, {
            "params": { "q": JSON.stringify(query) }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    create(endpoint, slug, title, text) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        let postRepr = {
            "slug": slug, "title": title, "text": text
        };
        return this.httpClient
            .post(`${this.config.serviceBaseUrl}/${apiEndpoint}`, postRepr)
            .pipe(map(data => {
            return data;
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    update(endpoint, id, slug, title, text) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        let postRepr = {
            "slug": slug, "title": title, "text": text
        };
        return this.httpClient
            .put(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`, postRepr)
            .pipe(map(data => {
            return data;
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    delete(endpoint, id) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .delete(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    assignTopics(endpoint, id, topicIds) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .put(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}/topics`, topicIds)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }));
    }
}
PostsService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: PostsService, deps: [{ token: PostsServiceConfigToken }, { token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
PostsService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: PostsService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: PostsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [PostsServiceConfigToken]
                }] }, { type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zdHMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Jsb2cvc3JjL2xpYi9zZXJ2aWNlcy9wb3N0cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRW5ELE9BQU8sRUFBa0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RCxPQUFPLEVBQXNCLHVCQUF1QixFQUFFLE1BQU0sa0JBQWtCLENBQUM7OztBQUsvRSxNQUFNLE9BQU8sWUFBWTtJQUl2QixZQUFxRCxNQUEwQixFQUFVLFVBQXNCO1FBQTFELFdBQU0sR0FBTixNQUFNLENBQW9CO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUZ4RyxhQUFRLEdBQWlCLElBQUksT0FBTyxFQUFPLENBQUM7SUFHakQsQ0FBQztJQUVJLEdBQUcsQ0FBQyxRQUFnQixFQUFFLFFBQW1CO1FBRTlDLE1BQU0sSUFBSSxHQUFXLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sUUFBUSxHQUFXLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDOUYsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO1FBRXRFLE9BQU8sSUFBSSxDQUFDLFVBQVU7YUFDWCxHQUFHLENBQTRCLEdBQUcs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Q1osQ0FBQztJQUdNLFlBQVksQ0FBQyxRQUFnQixFQUFFLEVBQVUsRUFBRSxRQUFrQjtRQUNsRSxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUM7UUFDdEUsT0FBTyxJQUFJLENBQUMsVUFBVTthQUNiLEdBQUcsQ0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxJQUFJLFdBQVcsSUFBSSxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUM7YUFDaEYsSUFBSSxDQUNILFVBQVUsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ3hCLE9BQU8sVUFBVSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDWixDQUFDOzt5R0FwSFUsWUFBWSxrQkFJSCx1QkFBdUI7NkdBSmhDLFlBQVksY0FGWCxNQUFNOzJGQUVQLFlBQVk7a0JBSHhCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzswQkFLYyxNQUFNOzJCQUFDLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBhZ2VhYmxlIH0gZnJvbSAndXRpbHMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIFN1YmplY3QsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIG1hcCwgdGFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBCbG9nUG9zdFJlc3BvbnNlTW9kZWwsIEJsb2dQb3N0TGlzdFJlc3BvbnNlTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvYmxvZy1wb3N0JztcbmltcG9ydCB7IFBvc3RzU2VydmljZUNvbmZpZywgUG9zdHNTZXJ2aWNlQ29uZmlnVG9rZW4gfSBmcm9tICcuLi9jb25maWcvY29uZmlnJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUG9zdHNTZXJ2aWNlIHtcblxuICBwdWJsaWMgb25DaGFuZ2U6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBvc3RzU2VydmljZUNvbmZpZ1Rva2VuKSBwcml2YXRlIGNvbmZpZzogUG9zdHNTZXJ2aWNlQ29uZmlnLCBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIFxuICB7IH1cblxuICBwdWJsaWMgYWxsKGVuZHBvaW50OiBzdHJpbmcsIHBhZ2VhYmxlPzogUGFnZWFibGUpOiBPYnNlcnZhYmxlPEJsb2dQb3N0TGlzdFJlc3BvbnNlTW9kZWw+IHtcblxuICAgIGNvbnN0IHBhZ2U6IG51bWJlciA9IHBhZ2VhYmxlID8gcGFnZWFibGUucGFnZSA6IDA7XG4gICAgY29uc3QgcGFnZVNpemU6IG51bWJlciA9IChwYWdlYWJsZSAmJiBwYWdlYWJsZS5saW1pdCkgPyBwYWdlYWJsZS5saW1pdCA6IHRoaXMuY29uZmlnLnBhZ2VTaXplO1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgICAgLmdldDxCbG9nUG9zdExpc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH1gLCB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICBcInBhZ2VcIjogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgXCJzaXplXCI6IHBhZ2VTaXplLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICBcInNvcnRcIjogXCJjcmVhdGVkT24sZGVzY1wiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBCbG9nUG9zdExpc3RSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgb25lKGVuZHBvaW50OiBzdHJpbmcsIGlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPEJsb2dQb3N0UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAgIC5nZXQ8QmxvZ1Bvc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtpZH1gKVxuICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBCbG9nUG9zdFJlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBmaW5kQnlTbHVnKGVuZHBvaW50OiBzdHJpbmcsIHNsdWc6IHN0cmluZyk6IE9ic2VydmFibGU8QmxvZ1Bvc3RMaXN0UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIFwiY29uZGl0aW9uc1wiOiBbXG4gICAgICAgIHsgXCJhdHRyaWJ1dGVcIjogXCJzbHVnXCIsIFwib3BlcmF0b3JcIjogXCJlcVwiLCBcInZhbHVlXCI6IHNsdWcgfVxuICAgICAgXVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLmdldDxCbG9nUG9zdExpc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vc2VhcmNoYCwgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwicGFyYW1zXCI6IHsgXCJxXCI6IEpTT04uc3RyaW5naWZ5KHF1ZXJ5KSB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBCbG9nUG9zdExpc3RSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGUoZW5kcG9pbnQ6IHN0cmluZywgc2x1Zzogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJsb2dQb3N0UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBsZXQgcG9zdFJlcHIgPSB7XG4gICAgICBcInNsdWdcIjogc2x1ZywgXCJ0aXRsZVwiOiB0aXRsZSwgXCJ0ZXh0XCI6IHRleHRcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5wb3N0PEJsb2dQb3N0UmVzcG9uc2VNb2RlbD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9YCwgcG9zdFJlcHIpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgbWFwKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhIGFzIEJsb2dQb3N0UmVzcG9uc2VNb2RlbDtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHRhcCh7XG4gICAgICAgICAgICAgICAgbmV4dDogeCA9PiB7IHRoaXMub25DaGFuZ2UubmV4dCh4KTsgfVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGUoZW5kcG9pbnQ6IHN0cmluZywgaWQ6IG51bWJlciwgc2x1Zzogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJsb2dQb3N0UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBsZXQgcG9zdFJlcHIgPSB7XG4gICAgICBcInNsdWdcIjogc2x1ZywgXCJ0aXRsZVwiOiB0aXRsZSwgXCJ0ZXh0XCI6IHRleHRcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5wdXQ8QmxvZ1Bvc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtpZH1gLCBwb3N0UmVwcilcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgQmxvZ1Bvc3RSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGRlbGV0ZShlbmRwb2ludDogc3RyaW5nLCBpZDogbnVtYmVyKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5kZWxldGU8dm9pZD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9LyR7aWR9YClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobmV3IEVycm9yKGVycm9yLnN0YXR1cykpO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cblxuICBwdWJsaWMgYXNzaWduVG9waWNzKGVuZHBvaW50OiBzdHJpbmcsIGlkOiBudW1iZXIsIHRvcGljSWRzOiBudW1iZXJbXSk6IE9ic2VydmFibGU8dm9pZD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAucHV0PHZvaWQ+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS8ke2lkfS90b3BpY3NgLCB0b3BpY0lkcylcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobmV3IEVycm9yKGVycm9yLnN0YXR1cykpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxufVxuIl19