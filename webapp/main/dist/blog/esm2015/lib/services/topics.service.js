import { Inject, Injectable } from '@angular/core';
import { Subject, throwError } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { TopicsServiceConfigToken } from '../config/config';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class TopicsService {
    constructor(config, httpClient) {
        this.config = config;
        this.httpClient = httpClient;
        this.onChange = new Subject();
    }
    all(endpoint, pageable) {
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}`, {
            params: {
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "caption,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    one(endpoint, id) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`)
            .pipe(map(data => {
            return data;
        }));
    }
    findByCaption(endpoint, caption, pageable) {
        const query = {
            "conditions": [
                { "attribute": "caption", "operator": "eq", "value": `%${caption}%` }
            ]
        };
        return this.search(endpoint, query, pageable);
    }
    findMatchingCaption(endpoint, caption, pageable) {
        const query = {
            "conditions": [
                { "attribute": "caption", "operator": "like", "value": `%${caption}%` }
            ]
        };
        return this.search(endpoint, query, pageable);
    }
    search(endpoint, query, pageable) {
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/search`, {
            "params": {
                "q": JSON.stringify(query),
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "caption,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    create(endpoint, caption) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const topicRepr = {
            "caption": caption
        };
        return this.httpClient
            .post(`${this.config.serviceBaseUrl}/${apiEndpoint}`, topicRepr)
            .pipe(map(data => {
            return data;
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    update(endpoint, id, caption) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const topicRepr = {
            "caption": caption
        };
        return this.httpClient
            .put(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`, topicRepr)
            .pipe(map(data => {
            return data;
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    delete(endpoint, id) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .delete(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
}
TopicsService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: TopicsService, deps: [{ token: TopicsServiceConfigToken }, { token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
TopicsService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: TopicsService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: TopicsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [TopicsServiceConfigToken]
                }] }, { type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9waWNzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ibG9nL3NyYy9saWIvc2VydmljZXMvdG9waWNzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbkQsT0FBTyxFQUFjLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUF1Qix3QkFBd0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7QUFNakYsTUFBTSxPQUFPLGFBQWE7SUFJeEIsWUFBc0QsTUFBMkIsRUFBVSxVQUFzQjtRQUEzRCxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7UUFGMUcsYUFBUSxHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO0lBR2pELENBQUM7SUFFSSxHQUFHLENBQUMsUUFBZ0IsRUFBRSxRQUFtQjtRQUU5QyxNQUFNLElBQUksR0FBVyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRCxNQUFNLFFBQVEsR0FBVyxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQzlGLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQztRQUV0RSxPQUFPLElBQUksQ0FBQyxVQUFVO2FBQ2IsR0FBRyxDQUF5QixHQUFH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QUMsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RDLENBQUMsQ0FDSCxDQUFDO0lBQ1osQ0FBQztJQUVNLE1BQU0sQ0FBQyxRQUFnQixFQUFFLEVBQVU7UUFDeEMsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO1FBQ3RFLE9BQU8sSUFBSSxDQUFDLFVBQVU7YUFDYixNQUFNLENBQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsSUFBSSxXQUFXLElBQUksRUFBRSxFQUFFLENBQUM7YUFDbEUsSUFBSSxDQUNILFVBQVUsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ3hCLE9BQU8sVUFBVSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxFQUNGLEdBQUcsQ0FBQztZQUNGLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN0QyxDQUFDLENBQ0gsQ0FBQztJQUNaLENBQUM7OzBHQTlIVSxhQUFhLGtCQUlKLHdCQUF3Qjs4R0FKakMsYUFBYSxjQUZaLE1BQU07MkZBRVAsYUFBYTtrQkFIekIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7OzBCQUtjLE1BQU07MkJBQUMsd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUGFnZWFibGUgfSBmcm9tICd1dGlscyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFRvcGljc1NlcnZpY2VDb25maWcsIFRvcGljc1NlcnZpY2VDb25maWdUb2tlbiB9IGZyb20gJy4uL2NvbmZpZy9jb25maWcnO1xuaW1wb3J0IHsgVG9waWNSZXNwb25zZU1vZGVsLCBUb3BpY0xpc3RSZXNwb25zZU1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3RvcGljJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgVG9waWNzU2VydmljZSB7XG5cbiAgcHVibGljIG9uQ2hhbmdlOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChUb3BpY3NTZXJ2aWNlQ29uZmlnVG9rZW4pIHByaXZhdGUgY29uZmlnOiBUb3BpY3NTZXJ2aWNlQ29uZmlnLCBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIFxuICB7IH1cblxuICBwdWJsaWMgYWxsKGVuZHBvaW50OiBzdHJpbmcsIHBhZ2VhYmxlPzogUGFnZWFibGUpOiBPYnNlcnZhYmxlPFRvcGljTGlzdFJlc3BvbnNlTW9kZWw+IHtcblxuICAgIGNvbnN0IHBhZ2U6IG51bWJlciA9IHBhZ2VhYmxlID8gcGFnZWFibGUucGFnZSA6IDA7XG4gICAgY29uc3QgcGFnZVNpemU6IG51bWJlciA9IChwYWdlYWJsZSAmJiBwYWdlYWJsZS5saW1pdCkgPyBwYWdlYWJsZS5saW1pdCA6IHRoaXMuY29uZmlnLnBhZ2VTaXplO1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8VG9waWNMaXN0UmVzcG9uc2VNb2RlbD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9YCwge1xuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiBwYWdlU2l6ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic29ydFwiOiBcImNhcHRpb24sYXNjXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgVG9waWNMaXN0UmVzcG9uc2VNb2RlbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgb25lKGVuZHBvaW50OiBzdHJpbmcsIGlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPFRvcGljUmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAgIC5nZXQ8VG9waWNSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtpZH1gKVxuICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBUb3BpY1Jlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBmaW5kQnlDYXB0aW9uKGVuZHBvaW50OiBzdHJpbmcsIGNhcHRpb246IHN0cmluZywgcGFnZWFibGU/OiBQYWdlYWJsZSk6IE9ic2VydmFibGU8VG9waWNMaXN0UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgXCJjb25kaXRpb25zXCI6IFtcbiAgICAgICAgeyBcImF0dHJpYnV0ZVwiOiBcImNhcHRpb25cIiwgXCJvcGVyYXRvclwiOiBcImVxXCIsIFwidmFsdWVcIjogYCUke2NhcHRpb259JWAgfVxuICAgICAgXVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoKGVuZHBvaW50LCBxdWVyeSwgcGFnZWFibGUpO1xuICB9XG5cbiAgcHVibGljIGZpbmRNYXRjaGluZ0NhcHRpb24oZW5kcG9pbnQ6IHN0cmluZywgY2FwdGlvbjogc3RyaW5nLCBwYWdlYWJsZT86IFBhZ2VhYmxlKTogT2JzZXJ2YWJsZTxUb3BpY0xpc3RSZXNwb25zZU1vZGVsPiB7XG4gICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICBcImNvbmRpdGlvbnNcIjogW1xuICAgICAgICB7IFwiYXR0cmlidXRlXCI6IFwiY2FwdGlvblwiLCBcIm9wZXJhdG9yXCI6IFwibGlrZVwiLCBcInZhbHVlXCI6IGAlJHtjYXB0aW9ufSVgIH1cbiAgICAgIF1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLnNlYXJjaChlbmRwb2ludCwgcXVlcnksIHBhZ2VhYmxlKTtcbiAgfVxuXG4gIHB1YmxpYyBzZWFyY2goZW5kcG9pbnQ6IHN0cmluZywgcXVlcnk6IGFueSwgcGFnZWFibGU/OiBQYWdlYWJsZSk6IE9ic2VydmFibGU8VG9waWNMaXN0UmVzcG9uc2VNb2RlbD4ge1xuXG4gICAgY29uc3QgcGFnZTogbnVtYmVyID0gcGFnZWFibGUgPyBwYWdlYWJsZS5wYWdlIDogMDtcbiAgICBjb25zdCBwYWdlU2l6ZTogbnVtYmVyID0gKHBhZ2VhYmxlICYmIHBhZ2VhYmxlLmxpbWl0KSA/IHBhZ2VhYmxlLmxpbWl0IDogdGhpcy5jb25maWcucGFnZVNpemU7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLmdldDxUb3BpY0xpc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vc2VhcmNoYCwgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwicGFyYW1zXCI6IHsgXG4gICAgICAgICAgICAgICAgXCJxXCI6IEpTT04uc3RyaW5naWZ5KHF1ZXJ5KSxcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiBwYWdlU2l6ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic29ydFwiOiBcImNhcHRpb24sYXNjXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgVG9waWNMaXN0UmVzcG9uc2VNb2RlbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlKGVuZHBvaW50OiBzdHJpbmcsIGNhcHRpb246IHN0cmluZyk6IE9ic2VydmFibGU8VG9waWNSZXNwb25zZU1vZGVsPiB7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuICAgIGNvbnN0IHRvcGljUmVwciA9IHtcbiAgICAgIFwiY2FwdGlvblwiOiBjYXB0aW9uXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAucG9zdDxUb3BpY1Jlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fWAsIHRvcGljUmVwcilcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgVG9waWNSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZShlbmRwb2ludDogc3RyaW5nLCBpZDogbnVtYmVyLCBjYXB0aW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFRvcGljUmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBjb25zdCB0b3BpY1JlcHIgPSB7XG4gICAgICBcImNhcHRpb25cIjogY2FwdGlvblxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLnB1dDxUb3BpY1Jlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS8ke2lkfWAsIHRvcGljUmVwcilcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgVG9waWNSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGRlbGV0ZShlbmRwb2ludDogc3RyaW5nLCBpZDogbnVtYmVyKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5kZWxldGU8dm9pZD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9LyR7aWR9YClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobmV3IEVycm9yKGVycm9yLnN0YXR1cykpO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG59XG4iXX0=