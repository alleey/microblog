import { Inject, Injectable } from '@angular/core';
import { Subject, throwError } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { FollowingServiceConfigToken } from '../config/config';
import * as i0 from "@angular/core";
import * as i1 from "auth-oidc";
import * as i2 from "@angular/common/http";
;
export class FollowingService {
    constructor(config, authService, httpClient) {
        this.config = config;
        this.authService = authService;
        this.httpClient = httpClient;
        this.onChange = new Subject();
        this.authService.userSubject.subscribe(profile => {
            this.userProfile = profile;
        });
    }
    followedByOne(endpoint, userId, followedById) {
        var _a;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        console.info("followed-by : " + followedById);
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/followedBy/${followedById}`)
            .pipe(map(data => {
            return data;
        }));
    }
    followedBy(endpoint, userId, pageable) {
        var _a;
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/followedBy`, {
            params: {
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "followedByName,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    findFollowedByMatching(endpoint, userId, name, pageable) {
        var _a;
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        const query = {
            "conditions": [
                { "attribute": "followedByName.fullName", "operator": "like", "value": `%${name}%` }
            ]
        };
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/followedBy/search`, {
            "params": {
                "q": JSON.stringify(query),
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "followedByName,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    followingOne(endpoint, userId, followedById) {
        var _a;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/following/${followedById}`)
            .pipe(map(data => {
            return data;
        }));
    }
    following(endpoint, userId, pageable) {
        var _a;
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/following`, {
            params: {
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "userName,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    findFollowingMatching(endpoint, userId, name, pageable) {
        var _a;
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        const query = {
            "conditions": [
                { "attribute": "userName.fullName", "operator": "like", "value": `%${name}%` }
            ]
        };
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/following/search`, {
            "params": {
                "q": JSON.stringify(query),
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "userName,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    follow(endpoint, followReq) {
        var _a, _b;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        followReq.followedById = !!followReq.followedById ? followReq.followedById : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        followReq.followedByName = !!followReq.followedByName ? followReq.followedByName : (_b = this.userProfile) === null || _b === void 0 ? void 0 : _b.name;
        const owner = followReq.followedById;
        return this.httpClient
            .put(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/following`, followReq)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    unfollow(endpoint, userId, userToUnfollow) {
        var _a;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const owner = !!userId ? userId : (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.sub;
        return this.httpClient
            .delete(`${this.config.serviceBaseUrl}/${apiEndpoint}/${owner}/following/${userToUnfollow}`)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
}
FollowingService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: FollowingService, deps: [{ token: FollowingServiceConfigToken }, { token: i1.OidcAuthService }, { token: i2.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
FollowingService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: FollowingService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: FollowingService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [FollowingServiceConfigToken]
                }] }, { type: i1.OidcAuthService }, { type: i2.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9sbG93aW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9mb2xsb3dlcnMvc3JjL2xpYi9zZXJ2aWNlcy9mb2xsb3dpbmcuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuRCxPQUFPLEVBQWMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RCxPQUFPLEVBQTBCLDJCQUEyQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7QUFTdEYsQ0FBQztBQUtGLE1BQU0sT0FBTyxnQkFBZ0I7SUFLM0IsWUFFVSxNQUE4QixFQUM5QixXQUE0QixFQUM1QixVQUFzQjtRQUZ0QixXQUFNLEdBQU4sTUFBTSxDQUF3QjtRQUM5QixnQkFBVyxHQUFYLFdBQVcsQ0FBaUI7UUFDNUIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQVB6QixhQUFRLEdBQWlCLElBQUksT0FBTyxFQUFPLENBQUM7UUFTakQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQy9DLElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLGFBQWEsQ0FBQyxRQUFnQixFQUFFLE1BQWMsRUFBRSxZQUFvQjs7UUFDekUsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO1FBQ3RFLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFD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SyxjQUFjLGNBQWMsRUFBRSxDQUFDO2FBQ2pHLElBQUksQ0FDSCxVQUFVLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRTtZQUN4QixPQUFPLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsRUFDRixHQUFHLENBQUM7WUFDRixJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdEMsQ0FBQyxDQUNILENBQUM7SUFDWixDQUFDOzs2R0FyTFUsZ0JBQWdCLGtCQU1qQiwyQkFBMkI7aUhBTjFCLGdCQUFnQixjQUZmLE1BQU07MkZBRVAsZ0JBQWdCO2tCQUg1QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7MEJBT0ksTUFBTTsyQkFBQywyQkFBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPaWRjQXV0aFNlcnZpY2UgfSBmcm9tICdhdXRoLW9pZGMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQYWdlYWJsZSB9IGZyb20gJ3V0aWxzJztcbmltcG9ydCB7IEZvbGxvd2luZ1NlcnZpY2VDb25maWcsIEZvbGxvd2luZ1NlcnZpY2VDb25maWdUb2tlbiB9IGZyb20gJy4uL2NvbmZpZy9jb25maWcnO1xuaW1wb3J0IHsgRm9sbG93ZWRCeUxpc3RSZXNwb25zZU1vZGVsLCBGb2xsb3dlZEJ5UmVzcG9uc2VNb2RlbCB9IGZyb20gJy4uL21vZGVscy9mb2xsb3dlZC1ieSc7XG5pbXBvcnQgeyBGb2xsb3dpbmdMaXN0UmVzcG9uc2VNb2RlbCB9IGZyb20gJy4uL21vZGVscy9mb2xsb3dpbmcnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZvbGxvd1JlcXVlc3Qge1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlck5hbWU6IHN0cmluZztcbiAgZm9sbG93ZWRCeUlkOiBzdHJpbmc7XG4gIGZvbGxvd2VkQnlOYW1lOiBzdHJpbmc7XG59O1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBGb2xsb3dpbmdTZXJ2aWNlIHtcblxuICBwdWJsaWMgb25DaGFuZ2U6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgcHJpdmF0ZSB1c2VyUHJvZmlsZTogYW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoRm9sbG93aW5nU2VydmljZUNvbmZpZ1Rva2VuKSBcbiAgICBwcml2YXRlIGNvbmZpZzogRm9sbG93aW5nU2VydmljZUNvbmZpZyxcbiAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBPaWRjQXV0aFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSBcbiAgeyBcbiAgICB0aGlzLmF1dGhTZXJ2aWNlLnVzZXJTdWJqZWN0LnN1YnNjcmliZShwcm9maWxlID0+IHtcbiAgICAgIHRoaXMudXNlclByb2ZpbGUgPSBwcm9maWxlO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGZvbGxvd2VkQnlPbmUoZW5kcG9pbnQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIGZvbGxvd2VkQnlJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxGb2xsb3dlZEJ5UmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBjb25zdCBvd25lciA9ICEhdXNlcklkID8gdXNlcklkIDogdGhpcy51c2VyUHJvZmlsZT8uc3ViO1xuXG4gICAgY29uc29sZS5pbmZvKFwiZm9sbG93ZWQtYnkgOiBcIiArIGZvbGxvd2VkQnlJZCk7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAuZ2V0PEZvbGxvd2VkQnlSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtvd25lcn0vZm9sbG93ZWRCeS8ke2ZvbGxvd2VkQnlJZH1gKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBGb2xsb3dlZEJ5UmVzcG9uc2VNb2RlbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgZm9sbG93ZWRCeShlbmRwb2ludDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgcGFnZWFibGU/OiBQYWdlYWJsZSk6IE9ic2VydmFibGU8Rm9sbG93ZWRCeUxpc3RSZXNwb25zZU1vZGVsPiB7XG5cbiAgICBjb25zdCBwYWdlOiBudW1iZXIgPSBwYWdlYWJsZSA/IHBhZ2VhYmxlLnBhZ2UgOiAwO1xuICAgIGNvbnN0IHBhZ2VTaXplOiBudW1iZXIgPSAocGFnZWFibGUgJiYgcGFnZWFibGUubGltaXQpID8gcGFnZWFibGUubGltaXQgOiB0aGlzLmNvbmZpZy5wYWdlU2l6ZTtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG4gICAgY29uc3Qgb3duZXIgPSAhIXVzZXJJZCA/IHVzZXJJZCA6IHRoaXMudXNlclByb2ZpbGU/LnN1YjtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8Rm9sbG93ZWRCeUxpc3RSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtvd25lcn0vZm9sbG93ZWRCeWAsIHtcbiAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgXCJwYWdlXCI6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBcInNpemVcIjogcGFnZVNpemUudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBcInNvcnRcIjogXCJmb2xsb3dlZEJ5TmFtZSxhc2NcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBGb2xsb3dlZEJ5TGlzdFJlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGZpbmRGb2xsb3dlZEJ5TWF0Y2hpbmcoZW5kcG9pbnQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgcGFnZWFibGU/OiBQYWdlYWJsZSk6IE9ic2VydmFibGU8Rm9sbG93ZWRCeUxpc3RSZXNwb25zZU1vZGVsPiB7XG5cbiAgICBjb25zdCBwYWdlOiBudW1iZXIgPSBwYWdlYWJsZSA/IHBhZ2VhYmxlLnBhZ2UgOiAwO1xuICAgIGNvbnN0IHBhZ2VTaXplOiBudW1iZXIgPSAocGFnZWFibGUgJiYgcGFnZWFibGUubGltaXQpID8gcGFnZWFibGUubGltaXQgOiB0aGlzLmNvbmZpZy5wYWdlU2l6ZTtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG4gICAgY29uc3Qgb3duZXIgPSAhIXVzZXJJZCA/IHVzZXJJZCA6IHRoaXMudXNlclByb2ZpbGU/LnN1YjtcblxuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgXCJjb25kaXRpb25zXCI6IFtcbiAgICAgICAgeyBcImF0dHJpYnV0ZVwiOiBcImZvbGxvd2VkQnlOYW1lLmZ1bGxOYW1lXCIsIFwib3BlcmF0b3JcIjogXCJsaWtlXCIsIFwidmFsdWVcIjogYCUke25hbWV9JWAgfVxuICAgICAgXVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLmdldDxGb2xsb3dlZEJ5TGlzdFJlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS8ke293bmVyfS9mb2xsb3dlZEJ5L3NlYXJjaGAsIFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcInBhcmFtc1wiOiB7IFxuICAgICAgICAgICAgICAgIFwicVwiOiBKU09OLnN0cmluZ2lmeShxdWVyeSksXG4gICAgICAgICAgICAgICAgXCJwYWdlXCI6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBcInNpemVcIjogcGFnZVNpemUudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBcInNvcnRcIjogXCJmb2xsb3dlZEJ5TmFtZSxhc2NcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBGb2xsb3dlZEJ5TGlzdFJlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGZvbGxvd2luZ09uZShlbmRwb2ludDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgZm9sbG93ZWRCeUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvbGxvd2VkQnlSZXNwb25zZU1vZGVsPiB7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuICAgIGNvbnN0IG93bmVyID0gISF1c2VySWQgPyB1c2VySWQgOiB0aGlzLnVzZXJQcm9maWxlPy5zdWI7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAuZ2V0PEZvbGxvd2VkQnlSZXNwb25zZU1vZGVsPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtvd25lcn0vZm9sbG93aW5nLyR7Zm9sbG93ZWRCeUlkfWApXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgbWFwKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhIGFzIEZvbGxvd2VkQnlSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBmb2xsb3dpbmcoZW5kcG9pbnQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIHBhZ2VhYmxlPzogUGFnZWFibGUpOiBPYnNlcnZhYmxlPEZvbGxvd2luZ0xpc3RSZXNwb25zZU1vZGVsPiB7XG5cbiAgICBjb25zdCBwYWdlOiBudW1iZXIgPSBwYWdlYWJsZSA/IHBhZ2VhYmxlLnBhZ2UgOiAwO1xuICAgIGNvbnN0IHBhZ2VTaXplOiBudW1iZXIgPSAocGFnZWFibGUgJiYgcGFnZWFibGUubGltaXQpID8gcGFnZWFibGUubGltaXQgOiB0aGlzLmNvbmZpZy5wYWdlU2l6ZTtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG4gICAgY29uc3Qgb3duZXIgPSAhIXVzZXJJZCA/IHVzZXJJZCA6IHRoaXMudXNlclByb2ZpbGU/LnN1YjtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8Rm9sbG93aW5nTGlzdFJlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS8ke293bmVyfS9mb2xsb3dpbmdgLCB7XG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIFwicGFnZVwiOiBwYWdlLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgXCJzaXplXCI6IHBhZ2VTaXplLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgXCJzb3J0XCI6IFwidXNlck5hbWUsYXNjXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgRm9sbG93aW5nTGlzdFJlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGZpbmRGb2xsb3dpbmdNYXRjaGluZyhlbmRwb2ludDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBwYWdlYWJsZT86IFBhZ2VhYmxlKTogT2JzZXJ2YWJsZTxGb2xsb3dpbmdMaXN0UmVzcG9uc2VNb2RlbD4ge1xuXG4gICAgY29uc3QgcGFnZTogbnVtYmVyID0gcGFnZWFibGUgPyBwYWdlYWJsZS5wYWdlIDogMDtcbiAgICBjb25zdCBwYWdlU2l6ZTogbnVtYmVyID0gKHBhZ2VhYmxlICYmIHBhZ2VhYmxlLmxpbWl0KSA/IHBhZ2VhYmxlLmxpbWl0IDogdGhpcy5jb25maWcucGFnZVNpemU7XG4gICAgY29uc3QgYXBpRW5kcG9pbnQgPSBlbmRwb2ludCA/IGVuZHBvaW50IDogdGhpcy5jb25maWcuZGVmYXVsdEVuZHBvaW50O1xuICAgIGNvbnN0IG93bmVyID0gISF1c2VySWQgPyB1c2VySWQgOiB0aGlzLnVzZXJQcm9maWxlPy5zdWI7XG5cbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIFwiY29uZGl0aW9uc1wiOiBbXG4gICAgICAgIHsgXCJhdHRyaWJ1dGVcIjogXCJ1c2VyTmFtZS5mdWxsTmFtZVwiLCBcIm9wZXJhdG9yXCI6IFwibGlrZVwiLCBcInZhbHVlXCI6IGAlJHtuYW1lfSVgIH1cbiAgICAgIF1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8Rm9sbG93aW5nTGlzdFJlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS8ke293bmVyfS9mb2xsb3dpbmcvc2VhcmNoYCwgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwicGFyYW1zXCI6IHsgXG4gICAgICAgICAgICAgICAgXCJxXCI6IEpTT04uc3RyaW5naWZ5KHF1ZXJ5KSxcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiBwYWdlU2l6ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic29ydFwiOiBcInVzZXJOYW1lLGFzY1wiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgbWFwKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhIGFzIEZvbGxvd2luZ0xpc3RSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBmb2xsb3coZW5kcG9pbnQ6IHN0cmluZywgZm9sbG93UmVxOiBGb2xsb3dSZXF1ZXN0KTogT2JzZXJ2YWJsZTx2b2lkPiB7XG5cbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG5cbiAgICBmb2xsb3dSZXEuZm9sbG93ZWRCeUlkID0gISFmb2xsb3dSZXEuZm9sbG93ZWRCeUlkID8gZm9sbG93UmVxLmZvbGxvd2VkQnlJZCA6IHRoaXMudXNlclByb2ZpbGU/LnN1YjtcbiAgICBmb2xsb3dSZXEuZm9sbG93ZWRCeU5hbWUgPSAhIWZvbGxvd1JlcS5mb2xsb3dlZEJ5TmFtZSA/IGZvbGxvd1JlcS5mb2xsb3dlZEJ5TmFtZSA6IHRoaXMudXNlclByb2ZpbGU/Lm5hbWU7XG4gICAgY29uc3Qgb3duZXIgPSBmb2xsb3dSZXEuZm9sbG93ZWRCeUlkO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLnB1dDx2b2lkPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtvd25lcn0vZm9sbG93aW5nYCwgZm9sbG93UmVxKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihuZXcgRXJyb3IoZXJyb3Iuc3RhdHVzKSk7XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB0YXAoe1xuICAgICAgICAgICAgICAgIG5leHQ6IHggPT4geyB0aGlzLm9uQ2hhbmdlLm5leHQoeCk7IH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgdW5mb2xsb3coZW5kcG9pbnQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIHVzZXJUb1VuZm9sbG93OiBzdHJpbmcpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcblxuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBjb25zdCBvd25lciA9ICEhdXNlcklkID8gdXNlcklkIDogdGhpcy51c2VyUHJvZmlsZT8uc3ViO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLmRlbGV0ZTx2b2lkPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtvd25lcn0vZm9sbG93aW5nLyR7dXNlclRvVW5mb2xsb3d9YClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobmV3IEVycm9yKGVycm9yLnN0YXR1cykpO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFwKHtcbiAgICAgICAgICAgICAgICBuZXh0OiB4ID0+IHsgdGhpcy5vbkNoYW5nZS5uZXh0KHgpOyB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG59XG4iXX0=