import { Inject, Injectable } from '@angular/core';
import { Subject, throwError } from 'rxjs';
import { catchError, map, tap } from "rxjs/operators";
import { BookmarksServiceConfigToken } from '../config/config';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class BookmarksService {
    constructor(config, httpClient) {
        this.config = config;
        this.httpClient = httpClient;
        this.onChange = new Subject();
    }
    all(endpoint, pageable) {
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}`, {
            params: {
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "caption,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    findMatchingCaption(endpoint, caption, pageable) {
        const query = {
            "conditions": [
                { "attribute": "caption", "operator": "like", "value": `%${caption}%` }
            ]
        };
        return this.search(endpoint, query, pageable);
    }
    search(endpoint, query, pageable) {
        const page = pageable ? pageable.page : 0;
        const pageSize = (pageable && pageable.limit) ? pageable.limit : this.config.pageSize;
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/search`, {
            "params": {
                "q": JSON.stringify(query),
                "page": page.toString(),
                "size": pageSize.toString(),
                "sort": "caption,asc"
            }
        })
            .pipe(map(data => {
            return data;
        }));
    }
    findByUrl(endpoint, url) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const query = {
            "conditions": [
                { "attribute": "url", "operator": "eq", "value": url }
            ]
        };
        return this.httpClient
            .get(`${this.config.serviceBaseUrl}/${apiEndpoint}/search`, {
            "params": { "q": JSON.stringify(query) }
        })
            .pipe(map(data => {
            return data._embedded.bookmarks[0];
        }));
    }
    create(endpoint, caption, url) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        const boomarkRepr = {
            "url": url, "caption": caption
        };
        return this.httpClient
            .post(`${this.config.serviceBaseUrl}/${apiEndpoint}`, boomarkRepr)
            .pipe(map(data => {
            return data;
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
    delete(endpoint, id) {
        const apiEndpoint = endpoint ? endpoint : this.config.defaultEndpoint;
        return this.httpClient
            .delete(`${this.config.serviceBaseUrl}/${apiEndpoint}/${id}`)
            .pipe(catchError((error) => {
            return throwError(new Error(error.status));
        }), tap({
            next: x => { this.onChange.next(x); }
        }));
    }
}
BookmarksService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: BookmarksService, deps: [{ token: BookmarksServiceConfigToken }, { token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
BookmarksService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: BookmarksService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.4", ngImport: i0, type: BookmarksService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [BookmarksServiceConfigToken]
                }] }, { type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9va21hcmtzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ib29rbWFya3Mvc3JjL2xpYi9zZXJ2aWNlcy9ib29rbWFya3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuRCxPQUFPLEVBQWMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RCxPQUFPLEVBQTBCLDJCQUEyQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7OztBQUt2RixNQUFNLE9BQU8sZ0JBQWdCO0lBSTNCLFlBRVUsTUFBOEIsRUFDOUIsVUFBc0I7UUFEdEIsV0FBTSxHQUFOLE1BQU0sQ0FBd0I7UUFDOUIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUx6QixhQUFRLEdBQWlCLElBQUksT0FBTyxFQUFPLENBQUM7SUFNbkQsQ0FBQztJQUVNLEdBQUcsQ0FBQyxRQUFnQixFQUFFLFFBQW1CO1FBRTlDLE1BQU0sSUFBSSxHQUFXLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sUUFBUSxHQUFXLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDOUYsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO1FBRXRFLE9BQU8sSUFBSSxDQUFDLFVBQVU7YUFDYixH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LEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdEMsQ0FBQyxDQUNILENBQUM7SUFDWixDQUFDOzs2R0EvR1UsZ0JBQWdCLGtCQUtqQiwyQkFBMkI7aUhBTDFCLGdCQUFnQixjQUZmLE1BQU07MkZBRVAsZ0JBQWdCO2tCQUg1QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7MEJBTUksTUFBTTsyQkFBQywyQkFBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQYWdlYWJsZSB9IGZyb20gJ3V0aWxzJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIG1hcCwgdGFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBCb29rbWFya1Jlc3BvbnNlTW9kZWwsIEJvb2ttYXJrTGlzdFJlc3BvbnNlTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvYm9va21hcmsnO1xuaW1wb3J0IHsgQm9va21hcmtzU2VydmljZUNvbmZpZywgQm9va21hcmtzU2VydmljZUNvbmZpZ1Rva2VuIH0gZnJvbSAnLi4vY29uZmlnL2NvbmZpZyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEJvb2ttYXJrc1NlcnZpY2Uge1xuXG4gIHB1YmxpYyBvbkNoYW5nZTogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3Q8YW55PigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoQm9va21hcmtzU2VydmljZUNvbmZpZ1Rva2VuKSBcbiAgICBwcml2YXRlIGNvbmZpZzogQm9va21hcmtzU2VydmljZUNvbmZpZyxcbiAgICBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHsgXG4gIH1cblxuICBwdWJsaWMgYWxsKGVuZHBvaW50OiBzdHJpbmcsIHBhZ2VhYmxlPzogUGFnZWFibGUpOiBPYnNlcnZhYmxlPEJvb2ttYXJrTGlzdFJlc3BvbnNlTW9kZWw+IHtcblxuICAgIGNvbnN0IHBhZ2U6IG51bWJlciA9IHBhZ2VhYmxlID8gcGFnZWFibGUucGFnZSA6IDA7XG4gICAgY29uc3QgcGFnZVNpemU6IG51bWJlciA9IChwYWdlYWJsZSAmJiBwYWdlYWJsZS5saW1pdCkgPyBwYWdlYWJsZS5saW1pdCA6IHRoaXMuY29uZmlnLnBhZ2VTaXplO1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcblxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8Qm9va21hcmtMaXN0UmVzcG9uc2VNb2RlbD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9YCwge1xuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiBwYWdlU2l6ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIFwic29ydFwiOiBcImNhcHRpb24sYXNjXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgYXMgQm9va21hcmtMaXN0UmVzcG9uc2VNb2RlbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgZmluZE1hdGNoaW5nQ2FwdGlvbihlbmRwb2ludDogc3RyaW5nLCBjYXB0aW9uOiBzdHJpbmcsIHBhZ2VhYmxlPzogUGFnZWFibGUpOiBPYnNlcnZhYmxlPEJvb2ttYXJrTGlzdFJlc3BvbnNlTW9kZWw+IHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIFwiY29uZGl0aW9uc1wiOiBbXG4gICAgICAgIHsgXCJhdHRyaWJ1dGVcIjogXCJjYXB0aW9uXCIsIFwib3BlcmF0b3JcIjogXCJsaWtlXCIsIFwidmFsdWVcIjogYCUke2NhcHRpb259JWAgfVxuICAgICAgXVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoKGVuZHBvaW50LCBxdWVyeSwgcGFnZWFibGUpO1xuICB9XG5cbiAgcHVibGljIHNlYXJjaChlbmRwb2ludDogc3RyaW5nLCBxdWVyeTogYW55LCBwYWdlYWJsZT86IFBhZ2VhYmxlKTogT2JzZXJ2YWJsZTxCb29rbWFya0xpc3RSZXNwb25zZU1vZGVsPiB7XG5cbiAgICBjb25zdCBwYWdlOiBudW1iZXIgPSBwYWdlYWJsZSA/IHBhZ2VhYmxlLnBhZ2UgOiAwO1xuICAgIGNvbnN0IHBhZ2VTaXplOiBudW1iZXIgPSAocGFnZWFibGUgJiYgcGFnZWFibGUubGltaXQpID8gcGFnZWFibGUubGltaXQgOiB0aGlzLmNvbmZpZy5wYWdlU2l6ZTtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAuZ2V0PEJvb2ttYXJrTGlzdFJlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fS9zZWFyY2hgLCBcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgXCJwYXJhbXNcIjogeyBcbiAgICAgICAgICAgICAgICBcInFcIjogSlNPTi5zdHJpbmdpZnkocXVlcnkpLFxuICAgICAgICAgICAgICAgIFwicGFnZVwiOiBwYWdlLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgXCJzaXplXCI6IHBhZ2VTaXplLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgXCJzb3J0XCI6IFwiY2FwdGlvbixhc2NcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBCb29rbWFya0xpc3RSZXNwb25zZU1vZGVsO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBmaW5kQnlVcmwoZW5kcG9pbnQ6IHN0cmluZywgdXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJvb2ttYXJrUmVzcG9uc2VNb2RlbD4ge1xuICAgIGNvbnN0IGFwaUVuZHBvaW50ID0gZW5kcG9pbnQgPyBlbmRwb2ludCA6IHRoaXMuY29uZmlnLmRlZmF1bHRFbmRwb2ludDtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIFwiY29uZGl0aW9uc1wiOiBbXG4gICAgICAgIHsgXCJhdHRyaWJ1dGVcIjogXCJ1cmxcIiwgXCJvcGVyYXRvclwiOiBcImVxXCIsIFwidmFsdWVcIjogdXJsIH1cbiAgICAgIF1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAgIC5nZXQ8Qm9va21hcmtMaXN0UmVzcG9uc2VNb2RlbD4oYCR7dGhpcy5jb25maWcuc2VydmljZUJhc2VVcmx9LyR7YXBpRW5kcG9pbnR9L3NlYXJjaGAsIFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcInBhcmFtc1wiOiB7IFwicVwiOiBKU09OLnN0cmluZ2lmeShxdWVyeSkgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuX2VtYmVkZGVkLmJvb2ttYXJrc1swXSBhcyBCb29rbWFya1Jlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZShlbmRwb2ludDogc3RyaW5nLCBjYXB0aW9uOiBzdHJpbmcsIHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxCb29rbWFya1Jlc3BvbnNlTW9kZWw+IHtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG4gICAgY29uc3QgYm9vbWFya1JlcHIgPSB7XG4gICAgICBcInVybFwiOiB1cmwsIFwiY2FwdGlvblwiOiBjYXB0aW9uXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAgICAgICAucG9zdDxCb29rbWFya1Jlc3BvbnNlTW9kZWw+KGAke3RoaXMuY29uZmlnLnNlcnZpY2VCYXNlVXJsfS8ke2FwaUVuZHBvaW50fWAsIGJvb21hcmtSZXByKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIG1hcChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBCb29rbWFya1Jlc3BvbnNlTW9kZWw7XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB0YXAoe1xuICAgICAgICAgICAgICAgIG5leHQ6IHggPT4geyB0aGlzLm9uQ2hhbmdlLm5leHQoeCk7IH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlKGVuZHBvaW50OiBzdHJpbmcsIGlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGVuZHBvaW50ID8gZW5kcG9pbnQgOiB0aGlzLmNvbmZpZy5kZWZhdWx0RW5kcG9pbnQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgLmRlbGV0ZTx2b2lkPihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlQmFzZVVybH0vJHthcGlFbmRwb2ludH0vJHtpZH1gKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihuZXcgRXJyb3IoZXJyb3Iuc3RhdHVzKSk7XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB0YXAoe1xuICAgICAgICAgICAgICAgIG5leHQ6IHggPT4geyB0aGlzLm9uQ2hhbmdlLm5leHQoeCk7IH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gIH1cbn1cbiJdfQ==